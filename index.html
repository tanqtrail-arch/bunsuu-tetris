<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>åˆ†æ•°ãƒ†ãƒˆãƒªã‚¹</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>body{margin:0;overflow-x:hidden;}</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
// â”€â”€â”€ TRAIL GP3 APIé€£æº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TRAIL_API = 'https://trail-game-pro-3-2.onrender.com';
const TRAIL_PLAYER = new URLSearchParams(location.search).get('player') || null;

function goHome() {
  window.location.href = TRAIL_PLAYER
    ? 'https://trail-game-pro-3-2.onrender.com'
    : location.href.split('?')[0];
}

let trailSent = false;
async function sendResultToTrail(score, alt) {
  if (!TRAIL_PLAYER || trailSent) return;
  trailSent = true;
  try {
    await fetch(`${TRAIL_API}/api/external/game-result`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        player: TRAIL_PLAYER,
        game_id: 'bunsuu-tetris',
        game_name: 'åˆ†æ•°ãƒ†ãƒˆãƒªã‚¹',
        score: score,
        alt: alt
      })
    });
  } catch (e) {
    console.error('ALTé€ä¿¡å¤±æ•—:', e);
  }
}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const {useState, useCallback, useRef, useEffect} = React;


const ROWS = 6;
const DIFF_FRACS = {
  easy: [{n:1,d:2},{n:1,d:3},{n:2,d:3},{n:1,d:4},{n:3,d:4}],
  normal: [{n:1,d:2},{n:1,d:3},{n:2,d:3},{n:1,d:4},{n:3,d:4},{n:1,d:6},{n:5,d:6},{n:1,d:5},{n:2,d:5},{n:3,d:5}],
  hard: [{n:1,d:2},{n:1,d:3},{n:2,d:3},{n:1,d:4},{n:3,d:4},{n:1,d:6},{n:5,d:6},{n:1,d:5},{n:2,d:5},{n:3,d:5},{n:4,d:5},{n:1,d:8},{n:3,d:8},{n:5,d:8},{n:7,d:8},{n:1,d:10},{n:3,d:10},{n:7,d:10},{n:9,d:10},{n:1,d:12},{n:5,d:12},{n:7,d:12},{n:11,d:12}],
};
const DM = {
  easy:{label:"ã‚„ã•ã—ã„",emoji:"ğŸ˜Š",color:"#4ECDC4",desc:"åˆ†æ¯2ã€œ4 / æ‰‹æœ­4æš",copies:5,skips:4,hs:4},
  normal:{label:"ãµã¤ã†",emoji:"ğŸ§©",color:"#FFE66D",desc:"åˆ†æ¯2ã€œ6 / æ‰‹æœ­4æš",copies:4,skips:3,hs:4},
  hard:{label:"ã‚€ãšã‹ã—ã„",emoji:"ğŸ”¥",color:"#FF6B6B",desc:"åˆ†æ¯2ã€œ12 / æ‰‹æœ­6æš",copies:3,skips:2,hs:6},
};
const CC={2:{bg:"#FF6B6B",gw:"#ff4444",lt:"#ff9999",tx:"#fff"},3:{bg:"#4ECDC4",gw:"#2dbdb4",lt:"#7eded8",tx:"#fff"},4:{bg:"#FFE66D",gw:"#ffd700",lt:"#fff0a0",tx:"#555"},5:{bg:"#A78BFA",gw:"#8b5cf6",lt:"#c4b5fd",tx:"#fff"},6:{bg:"#F97316",gw:"#ea580c",lt:"#fb923c",tx:"#fff"},8:{bg:"#ec4899",gw:"#db2777",lt:"#f9a8d4",tx:"#fff"},10:{bg:"#14b8a6",gw:"#0d9488",lt:"#5eead4",tx:"#fff"},12:{bg:"#6366f1",gw:"#4f46e5",lt:"#a5b4fc",tx:"#fff"},sp:{bg:"#38bdf8",gw:"#0ea5e9",lt:"#7dd3fc",tx:"#fff"}};
const SP_INFO={x2:{emoji:"âœ–ï¸",label:"Ã—2",desc:"2å€"},half:{emoji:"â—",label:"Ã·2",desc:"åŠåˆ†"},third:{emoji:"ğŸ”¹",label:"Ã·3",desc:"1/3"},sweep:{emoji:"ğŸ§¹",label:"ä¸€æƒ",desc:"è¡Œã‚¯ãƒªã‚¢"},snipe:{emoji:"ğŸ¯",label:"ç‹™æ’ƒ",desc:"1ã¤æ¶ˆã™"},slide:{emoji:"ğŸ”€",label:"ç§»å‹•",desc:"åˆ¥è¡Œã¸"}};

const fv=f=>f.n/f.d, gcd=(a,b)=>b===0?a:gcd(b,a%b);
function simp(n,d){const g=gcd(Math.abs(n),Math.abs(d));return{n:n/g,d:d/g};}
function rSum(bl){return bl.filter(b=>!b.type).reduce((s,b)=>s+fv(b),0);}
function rRem(bl){if(!bl.length)return{n:1,d:1};let tN=0,tD=1;for(const b of bl){if(b.type)continue;const g=gcd(tD,b.d),l=(tD*b.d)/g;tN=tN*(l/tD)+b.n*(l/b.d);tD=l;}const r=tD-tN;return r<=0?null:simp(r,tD);}
function bEq(bl){return bl.filter(b=>!b.type).map(b=>b.n+"/"+b.d).join(" + ")+" = 1";}
function getRedOpts(f){if(f.type)return[];const o=[],s=simp(f.n,f.d);if(s.n!==f.n||s.d!==f.d)o.push({...s,label:"ç´„åˆ†"});for(const m of[2,3,4,5,6]){const nn=f.n*m,nd=f.d*m;if(nd<=12&&!(nn===f.n&&nd===f.d))o.push({n:nn,d:nd,label:"Ã—"+m});}return o;}
function getEqOpts(f){if(f.type)return[];const v=fv(f),o=[];for(let d=2;d<=12;d++){const n=Math.round(v*d);if(n>0&&n<d&&Math.abs(n/d-v)<0.001&&!(n===f.n&&d===f.d)){const s=simp(n,d);if(s.n===n&&s.d===d)o.push({n,d});}}return o;}
const MSN=[{id:"two",desc:"2æšã§ã‚¯ãƒªã‚¢",ck:b=>b.filter(x=>!x.type).length===2,pts:300},{id:"three",desc:"3æšã§ã‚¯ãƒªã‚¢",ck:b=>b.filter(x=>!x.type).length===3,pts:200},{id:"sixth",desc:"1/6ã‚’ä½¿ã£ã¦ã‚¯ãƒªã‚¢",ck:b=>b.some(x=>x.n===1&&x.d===6),pts:200},{id:"fifth",desc:"åˆ†æ¯5ã§ã‚¯ãƒªã‚¢",ck:b=>b.some(x=>x.d===5),pts:250},{id:"samed",desc:"åŒã˜åˆ†æ¯ã ã‘ã§ã‚¯ãƒªã‚¢",ck:b=>{const d=b.filter(x=>!x.type).map(x=>x.d);return d.length>1&&d.every(x=>x===d[0]);},pts:350},{id:"four",desc:"4æšä»¥ä¸Šã§ã‚¯ãƒªã‚¢",ck:b=>b.filter(x=>!x.type).length>=4,pts:250}];
function pickM(dn){const a=MSN.filter(m=>!dn.includes(m.id));const p=a.length?a:MSN;return p[Math.floor(Math.random()*p.length)];}
function gRank(s,t,c){const e=t>0?s/t:0;if(e>=300&&c>=6)return{r:"S",c:"#FFE66D",m:"åˆ†æ•°ãƒã‚¹ã‚¿ãƒ¼ï¼ğŸŒŸ"};if(e>=200&&c>=4)return{r:"A",c:"#4ECDC4",m:"ã™ã”ã„ï¼âœ¨"};if(e>=120&&c>=3)return{r:"B",c:"#A78BFA",m:"ãªã‹ãªã‹ï¼ğŸ‘"};if(c>=2)return{r:"C",c:"#F97316",m:"ãŒã‚“ã°ã£ãŸï¼ğŸ’ª"};return{r:"D",c:"#94a3b8",m:"ã‚‚ã†ä¸€å›ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ğŸ”„"};}
function useLayout(){const[sz,setSz]=useState(()=>({w:typeof window!=="undefined"?window.innerWidth:400}));useEffect(()=>{const fn=()=>setSz({w:window.innerWidth});window.addEventListener("resize",fn);return()=>window.removeEventListener("resize",fn);},[]);const isTab=sz.w>=600;const BW=isTab?Math.min(520,sz.w-100):Math.min(380,sz.w-40);const RH=isTab?64:56;const fs=isTab?1.15:1;return{BW,RH,fs,isTab};}
function Pie({f,sz}){const r=sz/2-1,cx=sz/2,cy=sz/2,co=CC[f.d]?.lt||"#ccc",sl=[];for(let i=0;i<f.n;i++){const sa=(i/f.d)*360-90,ea=((i+1)/f.d)*360-90,sr=sa*Math.PI/180,er=ea*Math.PI/180;sl.push(<path key={i} d={"M"+cx+","+cy+" L"+(cx+r*Math.cos(sr))+","+(cy+r*Math.sin(sr))+" A"+r+","+r+" 0 "+(1/f.d>0.5?1:0)+",1 "+(cx+r*Math.cos(er))+","+(cy+r*Math.sin(er))+" Z"} fill={co} opacity={0.9}/>);}return(<svg width={sz} height={sz}><circle cx={cx} cy={cy} r={r} fill="rgba(255,255,255,0.15)" stroke="rgba(255,255,255,0.2)" strokeWidth={0.5}/>{sl}</svg>);}
function Blk({f,w,h,clr,nw,gl,hi}){const c=CC[f.d]||CC[2];return(<div className={clr?"bc":nw?"bn":""} style={{width:w-3,height:h-3,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",gap:4,background:"linear-gradient(145deg,"+c.lt+"ee,"+c.bg+")",boxShadow:gl?"0 0 12px "+c.gw+"66,0 2px 6px rgba(0,0,0,0.2),inset 0 1px 0 rgba(255,255,255,0.3)":"0 2px 6px rgba(0,0,0,0.2),inset 0 1px 0 rgba(255,255,255,0.3)",color:c.tx,fontFamily:"'Fredoka',sans-serif",fontWeight:600,fontSize:w>120?20:w>90?17:w>55?14:11,outline:hi?"2.5px solid #FFE66D":"none",outlineOffset:hi?-2:0}}><Pie f={f} sz={w>90?24:w>70?20:14}/><span>{f.n}<span style={{opacity:0.5,fontSize:"0.8em"}}>/</span>{f.d}</span></div>);}
function AltFloat({items}){return(<>{items.map(it=>(<div key={it.id} className="alt-float" style={{position:"fixed",left:"50%",top:"40%",zIndex:9999,pointerEvents:"none"}}>+{it.amount} ALT</div>))}</>);}

/* â”€â”€â”€ Ranking storage via persistent storage API â”€â”€â”€ */
function getWeekKey(){const now=new Date();const day=now.getDay();const diff=day===0?6:day-1;const mon=new Date(now);mon.setDate(now.getDate()-diff);mon.setHours(4,0,0,0);if(now<mon)mon.setDate(mon.getDate()-7);return "w-"+mon.toISOString().slice(0,10);}

function RankList({entries,myName,fs,isTab}){
  if(!entries||entries.length===0)return(<div style={{fontSize:Math.round(12*fs),opacity:0.4,textAlign:"center",padding:10}}>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>);
  const medals=["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];
  return(<div style={{display:"flex",flexDirection:"column",gap:3,width:"100%"}}>{entries.slice(0,10).map((e,i)=>{const isMe=myName&&e.name===myName;return(<div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:isTab?"6px 12px":"4px 10px",borderRadius:8,background:isMe?"rgba(78,205,196,0.12)":"rgba(255,255,255,0.03)",border:isMe?"1px solid rgba(78,205,196,0.3)":"1px solid transparent"}}>
    <div style={{width:28,textAlign:"center",fontSize:i<3?18:Math.round(12*fs),fontWeight:700,color:i<3?"#FFE66D":"rgba(255,255,255,0.5)"}}>{i<3?medals[i]:(i+1)}</div>
    <div style={{flex:1,fontSize:Math.round(13*fs),fontWeight:isMe?700:500,color:isMe?"#4ECDC4":"#fff"}}>{e.name}</div>
    <div style={{fontSize:Math.round(11*fs),opacity:0.5}}>{DM[e.diff]?.emoji||""}</div>
    <div style={{fontSize:Math.round(14*fs),fontWeight:700,color:"#FFE66D",minWidth:50,textAlign:"right"}}>{e.score.toLocaleString()}</div>
    <div style={{fontSize:Math.round(10*fs),fontWeight:600,color:e.rankColor||"#94a3b8",minWidth:18}}>{e.rank}</div>
  </div>);})}</div>);
}

function RankMini({entries,myEntry,myPos,fs,isTab}){
  const medals=["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];const top3=entries.slice(0,3);
  return(<div style={{display:"flex",flexDirection:"column",gap:2,width:"100%",fontSize:Math.round(11*fs)}}>
    {top3.map((e,i)=>{const isMe=myEntry&&e.name===myEntry.name&&e.score===myEntry.score&&i===myPos;return(<div key={i} style={{display:"flex",alignItems:"center",gap:6,padding:"3px 8px",borderRadius:6,background:isMe?"rgba(78,205,196,0.12)":"transparent"}}>
      <span style={{width:22,textAlign:"center"}}>{medals[i]}</span>
      <span style={{flex:1,fontWeight:isMe?700:400,color:isMe?"#4ECDC4":"rgba(255,255,255,0.7)"}}>{e.name}</span>
      <span style={{fontWeight:700,color:"#FFE66D"}}>{e.score.toLocaleString()}</span>
    </div>);})}
    {myPos!=null&&myPos>=3&&(<><div style={{textAlign:"center",opacity:0.3,fontSize:9}}>Â·Â·Â·</div><div style={{display:"flex",alignItems:"center",gap:6,padding:"3px 8px",borderRadius:6,background:"rgba(78,205,196,0.12)"}}>
      <span style={{width:22,textAlign:"center",fontWeight:700,color:"rgba(255,255,255,0.5)"}}>{myPos+1}</span>
      <span style={{flex:1,fontWeight:700,color:"#4ECDC4"}}>{myEntry.name}</span>
      <span style={{fontWeight:700,color:"#FFE66D"}}>{myEntry.score.toLocaleString()}</span>
    </div></>)}
  </div>);
}

function App(){
  const L=useLayout();const{BW,RH,fs,isTab}=L;
  const[df,sDf]=useState(null);const[rows,sRows]=useState(()=>Array.from({length:ROWS},()=>[]));
  const[hand,sHand]=useState([]);const[deck,sDeck]=useState([]);const[sel,sSel]=useState(null);
  const[sc,sSc]=useState(0);const[trn,sTrn]=useState(0);const[tc,sTc]=useState(0);
  const[gs,sGs]=useState("menu");const[clrR,sClrR]=useState([]);const[nwB,sNwB]=useState([]);
  const[shk,sShk]=useState(false);const[msg,sMsg]=useState(null);const[eq,sEq]=useState(null);
  const[skp,sSkp]=useState(3);const[hov,sHov]=useState(null);
  const[chn,sChn]=useState(0);const[msn,sMsn]=useState(null);const[mD,sMD]=useState([]);
  const[mF,sMF]=useState(false);const[exI,sExI]=useState(null);const[spM,sSpM]=useState(null);
  const[hSz,sHSz]=useState(4);const[rT,sRT]=useState(null);const[mA,sMA]=useState(null);
  const[slideFrom,setSlideFrom]=useState(null);
  const[retCf,setRetCf]=useState(false);
  const spR=useRef(null);

  /* ALT */
  const[altTotal,sAltTotal]=useState(0);const[altSession,sAltSession]=useState(0);
  const[altFloats,sAltFloats]=useState([]);
  const[clearedDiffs,sClearedDiffs]=useState([]);
  const[lineName,sLineName]=useState("");
  const altIdRef=useRef(0);

  /* Ranking */
  const[rkAll,setRkAll]=useState({easy:[],normal:[],hard:[]});
  const[rkWeek,setRkWeek]=useState({easy:[],normal:[],hard:[]});
  const[rkScreen,setRkScreen]=useState(false);
  const[rkDiff,setRkDiff]=useState("normal");
  const[rkTab,setRkTab]=useState("week");
  const[myRkPos,setMyRkPos]=useState(null);
  const[myRkEntry,setMyRkEntry]=useState(null);

  /* load rankings from persistent storage */
  const loadRankings=useCallback(async()=>{
    try{
      const wk=getWeekKey();
      const allRes=await window.storage.get("rank-all");
      if(allRes)setRkAll(JSON.parse(allRes.value));
      const weekRes=await window.storage.get("rank-"+wk);
      if(weekRes)setRkWeek(JSON.parse(weekRes.value));
      else setRkWeek({easy:[],normal:[],hard:[]});
    }catch(e){/* no data yet */}
  },[]);
  useEffect(()=>{loadRankings();},[loadRankings]);

  async function saveScore(name,score,diff,rank,rankColor){
    const entry={name,score,diff,rank,rankColor,ts:Date.now()};
    const wk=getWeekKey();
    /* all-time */
    let all;try{const r=await window.storage.get("rank-all");all=r?JSON.parse(r.value):{easy:[],normal:[],hard:[]};}catch(e){all={easy:[],normal:[],hard:[]};}
    all[diff]=[...all[diff],entry].sort((a,b)=>b.score-a.score).slice(0,10);
    await window.storage.set("rank-all",JSON.stringify(all));setRkAll(all);
    /* weekly */
    let week;try{const r=await window.storage.get("rank-"+wk);week=r?JSON.parse(r.value):{easy:[],normal:[],hard:[]};}catch(e){week={easy:[],normal:[],hard:[]};}
    week[diff]=[...week[diff],entry].sort((a,b)=>b.score-a.score).slice(0,10);
    await window.storage.set("rank-"+wk,JSON.stringify(week));setRkWeek(week);
    /* find my position */
    const pos=week[diff].findIndex(e=>e.name===name&&e.score===score&&e.ts===entry.ts);
    setMyRkPos(pos>=0?pos:null);setMyRkEntry(entry);
  }

  function addAltFloat(n){const id=++altIdRef.current;sAltFloats(f=>[...f,{id,amount:n}]);setTimeout(()=>sAltFloats(f=>f.filter(x=>x.id!==id)),1200);}
  function recalcX(row){let x=0;for(let i=0;i<row.length;i++){row[i].x=Math.round(x*1000)/1000;x+=fv(row[i]);}return row;}

  function bDeck(d){const fr=DIFF_FRACS[d],m=DM[d],dk=[];for(let i=0;i<m.copies;i++)for(const f of fr)dk.push({...f});const spTypes=["x2","half","third","sweep","snipe","slide"];const n=Math.floor(dk.length/8);for(let i=0;i<n;i++){dk.push({type:spTypes[Math.floor(Math.random()*spTypes.length)],n:0,d:1});}for(let i=dk.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[dk[i],dk[j]]=[dk[j],dk[i]];}return dk;}
  function drw(dk,n){return{drawn:dk.slice(0,n),rest:dk.slice(n)};}

  function aMerge(rs,ri){let row=rs[ri].map(b=>({...b})),mg=false,eqn=null,ch=true;while(ch){ch=false;for(let i=0;i<row.length-1;i++){const a=row[i],b=row[i+1];if(a.type||b.type)continue;if(a.d===b.d){const sn=a.n+b.n;if(sn>=a.d)continue;const s=simp(sn,a.d);if(!eqn)eqn=a.n+"/"+a.d+" + "+b.n+"/"+b.d+" = "+s.n+"/"+s.d;row.splice(i,2,{n:s.n,d:s.d,x:0});mg=true;ch=true;break;}}}if(!mg)return{rows:rs,mg:false};let x=0;for(let i=0;i<row.length;i++){row[i]={...row[i],x:Math.round(x*1000)/1000};x+=fv(row[i]);}const nr=rs.map((r,i)=>i===ri?row:r.map(b=>({...b})));if(eqn){sMA({row:ri,eq:eqn});sShk(true);setTimeout(()=>{sShk(false);sMA(null);},1200);}return{rows:nr,mg:true};}

  const pClr=useCallback((rs,cc,fH,fD,cb)=>{const fi=[];for(let i=0;i<ROWS;i++)if(rs[i].length>0&&Math.abs(rSum(rs[i])-1)<0.001)fi.push(i);if(!fi.length){sRows(rs);if(cc>1){sMsg(cc+"é€£ç¶šã‚¯ãƒªã‚¢ï¼+"+(cc*200)+"ğŸ”¥");setTimeout(()=>sMsg(null),1200);}sChn(0);cb&&cb(rs,fH,fD);return;}
    sEq(bEq(rs[fi[0]]));setTimeout(()=>sEq(null),1800);if(msn&&!mD.includes(msn.id)){for(const idx of fi){if(msn.ck(rs[idx])){sSc(s=>s+msn.pts);sMD(d=>[...d,msn.id]);sMF(true);setTimeout(()=>{sMF(false);sMsn(pickM([...mD,msn.id]));},1500);break;}}}for(const idx of fi){const cnt=rs[idx].filter(b=>!b.type).length;if(cnt===2){sSc(s=>s+500);sMsg("ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼+500ğŸŒŸ");setTimeout(()=>sMsg(null),1500);}else if(cnt===3)sSc(s=>s+200);}sClrR(fi);sRows(rs);sShk(true);setTimeout(()=>sShk(false),200);const nc=cc+1;sChn(nc);const pts=fi.reduce((s,i)=>s+rs[i].length,0)*100+fi.length*300+(nc>1?nc*200:0);sSc(s=>s+Math.floor(pts));sTc(t=>t+fi.length);setTimeout(()=>{const c2=rs.map((r,i)=>fi.includes(i)?[]:[...r]);const ne=c2.filter(r=>r.length>0);const st=[...Array.from({length:ROWS-ne.length},()=>[]),...ne];sClrR([]);pClr(st,nc,fH,fD,cb);},400);},[msn,mD]);

  function startG(d){const dd=d||df||"normal";sDf(dd);const m=DM[dd];sHSz(m.hs);const dk=bDeck(dd),{drawn,rest}=drw(dk,m.hs);sDeck(rest);sHand(drawn);sRows(Array.from({length:ROWS},()=>[]));sSc(0);sTrn(0);sTc(0);sClrR([]);sNwB([]);sSel(null);sSkp(m.skips);sChn(0);sMsn(pickM([]));sMD([]);sMF(false);sExI(null);sSpM(null);sRT(null);sMA(null);setSlideFrom(null);setRetCf(false);sAltSession(0);setMyRkPos(null);setMyRkEntry(null);sGs("playing");}

  const cFit=useCallback((f,rb)=>!f.type&&rSum(rb)+fv(f)<=1.001,[]);
  const cAny=useCallback((h,rs)=>{for(const c of h){if(c.type){for(const r of rs)if(r.length>0)return true;}else{for(const r of rs)if(cFit(c,r))return true;}}return false;},[cFit]);
  function refill(h,dk){const n=hSz-h.length;if(n>0&&dk.length>0){const t=Math.min(n,dk.length);return{h:[...h,...dk.slice(0,t)],d:dk.slice(t)};}return{h,d:dk};}
  function finishSp(){const nh=hand.filter((_,i)=>i!==spR.current);sSpM(null);spR.current=null;sSel(null);setSlideFrom(null);sTrn(t=>t+1);const rf=refill(nh,deck);sDeck(rf.d);sHand(rf.h);return rf;}
  function cancelSp(){sSpM(null);spR.current=null;sSel(null);setSlideFrom(null);}

  const onRowClick=useCallback((ri)=>{
    if(spM==="slide"&&slideFrom){
      if(ri===slideFrom.row)return;const nr=rows.map(r=>r.map(b=>({...b})));const blk={...nr[slideFrom.row][slideFrom.idx]};
      if(rSum(nr[ri])+fv(blk)>1.001){sMsg("å…¥ã‚Šãã‚‰ãªã„ï¼");setTimeout(()=>sMsg(null),800);return;}
      nr[slideFrom.row].splice(slideFrom.idx,1);recalcX(nr[slideFrom.row]);nr[ri].push(blk);recalcX(nr[ri]);
      sMsg("ğŸ”€ ç§»å‹•å®Œäº†ï¼");setTimeout(()=>sMsg(null),800);sShk(true);setTimeout(()=>sShk(false),200);
      const rf=finishSp();let fr=nr;const m1=aMerge(fr,slideFrom.row);if(m1.mg)fr=m1.rows;const m2=aMerge(fr,ri);if(m2.mg)fr=m2.rows;
      pClr(fr,0,rf.h,rf.d,(s)=>{sRows(s);});return;
    }
    if(spM==="sweep"){
      if(rows[ri].length===0)return;const nr=rows.map(r=>[...r]);nr[ri]=[];
      sMsg("ğŸ§¹ ä¸€æƒï¼");setTimeout(()=>sMsg(null),800);sShk(true);setTimeout(()=>sShk(false),200);
      const rf=finishSp();const ne=nr.filter(r=>r.length>0);const st=[...Array.from({length:ROWS-ne.length},()=>[]),...ne];sRows(st);return;
    }
    if(sel===null||gs!=="playing")return;const card=hand[sel];
    if(card.type){sSpM(card.type);spR.current=sel;return;}
    if(!cFit(card,rows[ri]))return;
    let nr=rows.map((r,i)=>{if(i!==ri)return[...r];const a=[...r];a.push({...card,x:Math.round(rSum(a)*1000)/1000});return a;});
    const mr=aMerge(nr,ri);if(mr.mg)nr=mr.rows;else{sNwB([{row:ri,idx:nr[ri].length-1}]);setTimeout(()=>sNwB([]),250);}
    const nh=hand.filter((_,i)=>i!==sel);sSel(null);sTrn(t=>t+1);const rf=refill(nh,deck);sDeck(rf.d);sHand(rf.h);pClr(nr,0,rf.h,rf.d,(s)=>{sRows(s);});
  },[sel,hand,rows,gs,deck,cFit,pClr,hSz,spM,slideFrom]);

  const onBlkClick=useCallback((r,bi)=>{
    const b=rows[r][bi];if(!b||b.type)return;
    if(spM==="snipe"){const nr=rows.map(rr=>rr.map(bb=>({...bb})));nr[r].splice(bi,1);recalcX(nr[r]);sMsg("ğŸ¯ "+b.n+"/"+b.d+" æ¶ˆå»ï¼");setTimeout(()=>sMsg(null),800);sShk(true);setTimeout(()=>sShk(false),200);const rf=finishSp();const mr=aMerge(nr,r);pClr(mr.mg?mr.rows:nr,0,rf.h,rf.d,(s)=>{sRows(s);});return;}
    if(spM==="slide"&&!slideFrom){setSlideFrom({row:r,idx:bi});return;}
    if(spM==="x2"||spM==="half"||spM==="third"){
      const nr=rows.map(rr=>rr.map(bb=>({...bb})));const t=nr[r][bi];
      if(spM==="x2"){const nn=t.n*2;if(nn>=t.d){nr[r].splice(bi,1);recalcX(nr[r]);sMsg("ğŸ’¥ æ¶ˆæ»…ï¼");setTimeout(()=>sMsg(null),1000);sShk(true);setTimeout(()=>sShk(false),200);const rf=finishSp();pClr(nr,0,rf.h,rf.d,(s)=>{sRows(s);});return;}nr[r][bi]={...t,...simp(nn,t.d)};}
      else if(spM==="half")nr[r][bi]={...t,...simp(t.n,t.d*2)};
      else nr[r][bi]={...t,...simp(t.n,t.d*3)};
      recalcX(nr[r]);if(rSum(nr[r])>1.001){sMsg("ã¯ã¿å‡ºã™ï¼");setTimeout(()=>sMsg(null),800);return;}
      const rf=finishSp();const mr=aMerge(nr,r);pClr(mr.mg?mr.rows:nr,0,rf.h,rf.d,(s)=>{sRows(s);});return;
    }
    if(sel!==null)return;if(rT&&rT.row===r&&rT.idx===bi)sRT(null);else sRT({row:r,idx:bi});
  },[spM,sel,rows,rT,slideFrom,hand,deck,pClr,hSz]);

  const appRed=useCallback((ri,bi,nf)=>{const nr=rows.map(r=>r.map(b=>({...b})));const old=nr[ri][bi];if(Math.abs(fv(old)-fv(nf))>0.001)return;nr[ri][bi]={...old,n:nf.n,d:nf.d};recalcX(nr[ri]);const mr=aMerge(nr,ri);const fr=mr.mg?mr.rows:nr;sRows(fr);sRT(null);if(!mr.mg){sMsg("ğŸ”„ "+old.n+"/"+old.d+" â†’ "+nf.n+"/"+nf.d);setTimeout(()=>sMsg(null),800);}if(Math.abs(rSum(fr[ri])-1)<0.001)setTimeout(()=>pClr(fr,0,hand,deck,(s)=>{sRows(s);}),300);},[rows,hand,deck,pClr]);
  const doEx=useCallback((hi,nf)=>{const nh=[...hand];const o=nh[hi];nh[hi]={...nf};sHand(nh);sExI(null);sMsg("ğŸ”„ "+o.n+"/"+o.d+" â†’ "+nf.n+"/"+nf.d);setTimeout(()=>sMsg(null),800);},[hand]);
  function skip(){if(skp<=0||gs!=="playing")return;sSkp(s=>s-1);if(deck.length>=hSz){const{drawn,rest}=drw(deck,hSz);sHand(drawn);sDeck(rest);}else if(deck.length>0){sHand([...deck]);sDeck([]);}sSel(null);sTrn(t=>t+1);sExI(null);cancelSp();}
  function doRetire(){setRetCf(false);cancelSp();sSel(null);sGs("retire");}

  useEffect(()=>{if(gs!=="playing")return;if(hand.length===0&&deck.length===0)setTimeout(()=>sGs("perfect"),300);else if(hand.length>0&&!cAny(hand,rows)&&skp<=0&&deck.length===0)setTimeout(()=>sGs("gameover"),500);},[hand,deck,rows,gs,cAny,skp]);

  /* â”€â”€â”€ Game end: ALT award + ranking save â”€â”€â”€ */
  const bonusAwarded=useRef(false);
  useEffect(()=>{
    if((gs==="perfect"||gs==="gameover"||gs==="retire")&&!bonusAwarded.current){
      bonusAwarded.current=true;
      const isPerfect=gs==="perfect";
      const isRetire=gs==="retire";
      /* completion bonus for natural game end */
      let cmpB=0;
      if(!isRetire&&!isPerfect&&tc>=1){cmpB=300;sSc(s=>s+300);}
      const finalSc=sc+cmpB;
      const rank=isPerfect?{r:"S",c:"#FFE66D"}:gRank(finalSc,trn,tc);
      /* ALT: retire=1(if cleared), gameover=3, perfect=10 */
      let alt=0;
      if(isPerfect)alt=10;
      else if(isRetire)alt=tc>=1?1:0;
      else if(tc>=1)alt=3;
      let fcb=0;
      if(df&&!clearedDiffs.includes(df)&&tc>=1&&!isRetire){fcb=5;sClearedDiffs(p=>[...p,df]);}
      const totalAlt=alt+fcb;
      sAltSession(totalAlt);
      if(totalAlt>0){sAltTotal(t=>t+totalAlt);setTimeout(()=>addAltFloat(totalAlt),500);}
      /* save ranking if name set and scored */
      if(lineName.trim()&&finalSc>0&&df){saveScore(lineName.trim(),finalSc,df,rank.r,rank.c);}
      /* TRAIL GP3: send result (not for retire) */
      if(finalSc>0&&!isRetire){sendResultToTrail(finalSc,totalAlt);}
    }
  },[gs]);
  useEffect(()=>{if(gs==="playing"){bonusAwarded.current=false;trailSent=false;}},[gs]);

  const bH=ROWS*RH;const isPf=gs==="perfect";const isRt=gs==="retire";
  let ri=isPf?{r:"S",c:"#FFE66D",m:"ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼å…¨ã‚«ãƒ¼ãƒ‰åˆ¶è¦‡ï¼ğŸ†"}:gRank(sc,trn,tc);if(isRt)ri={...ri,m:"ã¾ãŸéŠã¼ã†ï¼ğŸ‘‹"};
  const stars=isPf||ri.r==="S"?3:ri.r==="A"?2:1;
  const maxW=isTab?580:460;const cardW=isTab?(hSz>4?82:96):(hSz>4?66:76);
  const spLabel=spM==="sweep"?"ğŸ§¹ æ¶ˆã—ãŸã„è¡Œã‚’ã‚¿ãƒƒãƒ—":spM==="snipe"?"ğŸ¯ æ¶ˆã—ãŸã„ãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚¿ãƒƒãƒ—":spM==="slide"?(slideFrom?"ğŸ”€ ç§»å‹•å…ˆã®è¡Œã‚’ã‚¿ãƒƒãƒ—":"ğŸ”€ ç§»å‹•ã™ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚¿ãƒƒãƒ—"):spM==="x2"?"âœ–ï¸ 2å€ã«ã™ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚¿ãƒƒãƒ—":spM==="half"?"â— åŠåˆ†ã«ã™ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚¿ãƒƒãƒ—":spM==="third"?"ğŸ”¹ 1/3ã«ã™ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚¿ãƒƒãƒ—":"";
  const curRk=rkTab==="week"?rkWeek:rkAll;

  return(<div style={{minHeight:"100vh",background:"linear-gradient(150deg,#0f172a,#1e1b4b 50%,#1a1333)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:"'Fredoka',sans-serif",color:"#fff",padding:isTab?20:10,userSelect:"none",paddingBottom:gs==="menu"?80:10}}>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    {gs==="menu"&&(<div style={{position:"fixed",top:12,right:14,zIndex:100,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",borderRadius:12,padding:isTab?"8px 18px":"6px 14px",border:"1px solid rgba(78,205,196,0.2)",display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:isTab?20:16}}>ğŸª™</span><span style={{fontSize:isTab?20:16,fontWeight:700,color:"#4ECDC4"}}>{altTotal}</span><span style={{fontSize:isTab?12:10,opacity:0.5,color:"#4ECDC4"}}>ALT</span></div>)}
    <AltFloat items={altFloats}/>
    <h1 style={{fontSize:Math.round(24*fs),fontWeight:700,margin:"0 0 1px",background:"linear-gradient(90deg,#FF6B6B,#4ECDC4,#FFE66D,#A78BFA)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:2}}>ğŸƒ åˆ†æ•°ãƒ†ãƒˆãƒªã‚¹</h1>
    <p style={{margin:"0 0 8px",opacity:0.4,fontSize:Math.round(11*fs)}}>æ‰‹æœ­ã‹ã‚‰é¸ã‚“ã§è¡Œã«é…ç½®ã€‚ã´ã£ãŸã‚Š1ã‚’ä½œã‚ã†ï¼</p>

    {/* â”€â”€â”€ RANKING SCREEN â”€â”€â”€ */}
    {rkScreen&&(<div className="fi" style={{width:"100%",maxWidth:maxW,background:"rgba(255,255,255,0.04)",borderRadius:20,padding:isTab?"24px 28px":"18px 20px",backdropFilter:"blur(12px)",border:"1px solid rgba(255,255,255,0.08)"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
        <div style={{fontSize:Math.round(18*fs),fontWeight:700}}>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
        <button onClick={()=>setRkScreen(false)} className="bs" style={{fontSize:Math.round(12*fs),padding:"4px 14px",borderRadius:8,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff",cursor:"pointer",fontFamily:"'Fredoka',sans-serif"}}>âœ• é–‰ã˜ã‚‹</button>
      </div>
      <div style={{display:"flex",gap:6,marginBottom:10}}>
        {(["week","all"]).map(t=>(<button key={t} onClick={()=>setRkTab(t)} className="bs" style={{flex:1,padding:"6px 0",borderRadius:8,fontSize:Math.round(12*fs),fontWeight:600,fontFamily:"'Fredoka',sans-serif",background:rkTab===t?"rgba(78,205,196,0.15)":"rgba(255,255,255,0.04)",border:rkTab===t?"1.5px solid rgba(78,205,196,0.4)":"1px solid rgba(255,255,255,0.06)",color:rkTab===t?"#4ECDC4":"rgba(255,255,255,0.5)",cursor:"pointer"}}>{t==="week"?"ğŸ“… é€±é–“":"ğŸ‘‘ æ°¸ä¹…"}</button>))}
      </div>
      <div style={{display:"flex",gap:4,marginBottom:10}}>
        {(["easy","normal","hard"]).map(d=>(<button key={d} onClick={()=>setRkDiff(d)} className="bs" style={{flex:1,padding:"5px 0",borderRadius:6,fontSize:Math.round(11*fs),fontWeight:600,fontFamily:"'Fredoka',sans-serif",background:rkDiff===d?"rgba(255,255,255,0.08)":"transparent",border:rkDiff===d?"1.5px solid "+DM[d].color+"66":"1px solid rgba(255,255,255,0.04)",color:rkDiff===d?DM[d].color:"rgba(255,255,255,0.4)",cursor:"pointer"}}>{DM[d].emoji+" "+DM[d].label}</button>))}
      </div>
      {rkTab==="week"&&<div style={{fontSize:9,opacity:0.3,textAlign:"center",marginBottom:6}}>æ¯é€±æœˆæ›œ AM4:00 ãƒªã‚»ãƒƒãƒˆ</div>}
      <RankList entries={curRk[rkDiff]} myName={lineName.trim()} fs={fs} isTab={isTab}/>
    </div>)}

    {/* â”€â”€â”€ MENU â”€â”€â”€ */}
    {gs==="menu"&&!rkScreen&&(<div className="fi" style={{textAlign:"center",background:"rgba(255,255,255,0.04)",borderRadius:20,padding:isTab?"28px 36px":"22px 28px",maxWidth:maxW,width:"100%",backdropFilter:"blur(12px)",border:"1px solid rgba(255,255,255,0.08)"}}>
      <div style={{fontSize:Math.round(14*fs),marginBottom:10,lineHeight:2,opacity:0.9}}><p style={{margin:0}}>ğŸƒ æ‰‹æœ­ã‹ã‚‰åˆ†æ•°ã‚«ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§å¥½ããªè¡Œã«é…ç½®</p><p style={{margin:0}}>åˆè¨ˆ <strong style={{color:"#FFE66D",fontSize:Math.round(18*fs)}}>ã¡ã‚‡ã†ã©1</strong> ã«ãªã£ãŸã‚‰ã‚¯ãƒªã‚¢ï¼</p></div>
      {/* name input at top of menu */}
      <div style={{marginBottom:12}}><input value={lineName} onChange={e=>sLineName(e.target.value)} placeholder="ãªã¾ãˆã‚’å…¥åŠ›ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”¨ï¼‰" style={{width:"100%",maxWidth:isTab?320:260,padding:isTab?"10px 16px":"8px 14px",borderRadius:10,border:"1.5px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.05)",color:"#fff",fontSize:Math.round(13*fs),fontFamily:"'Fredoka',sans-serif",outline:"none",textAlign:"center"}}/></div>
      <div style={{fontSize:Math.round(13*fs),fontWeight:600,opacity:0.7,marginBottom:8}}>é›£æ˜“åº¦ã‚’ãˆã‚‰ã¼ã†</div>
      <div style={{display:"flex",gap:isTab?12:8,justifyContent:"center",marginBottom:14}}>
        {["easy","normal","hard"].map(d=>{const m=DM[d],dens=[...new Set(DIFF_FRACS[d].map(f=>f.d))].sort((a,b)=>a-b),done=clearedDiffs.includes(d);return(<button key={d} onClick={()=>startG(d)} className="bs dc" style={{flex:1,maxWidth:isTab?170:140,padding:isTab?"18px 10px":"14px 8px",borderRadius:14,background:"rgba(255,255,255,0.04)",border:"2px solid "+m.color+"44",color:"#fff",cursor:"pointer",fontFamily:"'Fredoka',sans-serif",display:"flex",flexDirection:"column",alignItems:"center",gap:6,transition:"all 0.15s",position:"relative"}}>{done&&<div style={{position:"absolute",top:4,right:6,fontSize:isTab?11:9,color:"#4ECDC4"}}>âœ…</div>}<span style={{fontSize:isTab?34:28}}>{m.emoji}</span><div style={{fontSize:Math.round(15*fs),fontWeight:700,color:m.color}}>{m.label}</div><div style={{fontSize:Math.round(10*fs),opacity:0.5,lineHeight:1.5}}>{m.desc}</div><div style={{display:"flex",gap:2,flexWrap:"wrap",justifyContent:"center",marginTop:4}}>{dens.map(dn=>{const co=CC[dn]||CC[2];return(<div key={dn} style={{padding:"1px 5px",borderRadius:4,fontSize:Math.round(9*fs),fontWeight:600,background:co.bg+"44",color:co.lt,border:"1px solid "+co.bg+"66"}}>/{dn}</div>);})}</div></button>);})}
      </div>
      <button onClick={()=>{setRkScreen(true);setRkDiff(df||"normal");loadRankings();}} className="bs" style={{padding:isTab?"10px 28px":"8px 22px",fontSize:Math.round(14*fs),fontWeight:700,fontFamily:"'Fredoka',sans-serif",borderRadius:12,background:"rgba(255,230,109,0.08)",border:"1.5px solid rgba(255,230,109,0.2)",color:"#FFE66D",cursor:"pointer",marginBottom:10}}>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¦‹ã‚‹</button>
      <div style={{fontSize:Math.round(10*fs),opacity:0.4,lineHeight:1.8}}>ğŸŒŸãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆ / ğŸãƒŸãƒƒã‚·ãƒ§ãƒ³ / ğŸ§¹ä¸€æƒ / ğŸ¯ç‹™æ’ƒ / ğŸ”€ç§»å‹• / âœ–ï¸Ã—2 / â—Ã·2 / ğŸ”¹Ã·3</div>
    </div>)}

    {/* â”€â”€â”€ PLAYING / RESULT â”€â”€â”€ */}
    {(gs==="playing"||gs==="gameover"||gs==="perfect"||gs==="retire")&&(<div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:isTab?14:10}}>
      <div style={{display:"flex",gap:isTab?20:14,alignItems:"center",flexWrap:"wrap",justifyContent:"center"}}>
        {[{l:"ã‚¹ã‚³ã‚¢",v:sc,c:"#FFE66D"},{l:"ã‚¿ãƒ¼ãƒ³",v:trn,c:"#4ECDC4"},{l:"ã‚¯ãƒªã‚¢",v:tc,c:"#A78BFA"},{l:"æ®‹ã‚Š",v:deck.length,c:"#F97316"}].map(({l,v,c})=>(<div key={l} style={{textAlign:"center"}}><div style={{fontSize:Math.round(9*fs),opacity:0.4}}>{l}</div><div className="sp" key={l+v} style={{fontSize:Math.round(17*fs),fontWeight:700,color:c}}>{v}</div></div>))}
      </div>
      {msn&&gs==="playing"&&(<div className={mF?"md":""} style={{background:mF?"rgba(78,205,196,0.15)":"rgba(255,255,255,0.04)",borderRadius:10,padding:isTab?"6px 20px":"5px 16px",border:mF?"1.5px solid #4ECDC4":"1px solid rgba(255,255,255,0.06)",fontSize:Math.round(12*fs),textAlign:"center"}}>ğŸ ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼š<span style={{color:"#FFE66D",fontWeight:600}}>{msn.desc}</span><span style={{opacity:0.5,marginLeft:6}}>+{msn.pts}</span></div>)}

      <div style={{position:"relative"}}>
        {spM&&(<div style={{position:"absolute",top:-36,left:0,width:BW,textAlign:"center",fontSize:Math.round(13*fs),fontWeight:600,color:"#7dd3fc",zIndex:10}}>{spLabel}<button onClick={cancelSp} className="bs" style={{marginLeft:8,fontSize:Math.round(10*fs),padding:"2px 8px",borderRadius:6,background:"transparent",border:"1px solid rgba(255,255,255,0.15)",color:"rgba(255,255,255,0.5)",cursor:"pointer",fontFamily:"'Fredoka',sans-serif"}}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button></div>)}
        <div className={shk?"bsh":""} style={{width:BW,height:bH,background:"rgba(0,0,0,0.3)",borderRadius:isTab?18:14,border:"1.5px solid rgba(255,255,255,0.08)",overflow:"hidden",position:"relative",boxShadow:"0 0 50px rgba(0,0,0,0.3),inset 0 0 30px rgba(0,0,0,0.15)"}}>
        {chn>0&&<div style={{position:"absolute",inset:0,background:chn>2?"rgba(255,107,107,0.08)":chn>1?"rgba(255,230,109,0.05)":"transparent",pointerEvents:"none",transition:"background 0.3s"}}/>}
        {Array.from({length:ROWS-1},(_,i)=><div key={"h"+i} style={{position:"absolute",top:(i+1)*RH,left:0,width:"100%",height:1,background:"rgba(255,255,255,0.04)"}}/>)}
        {[1/6,2/6,3/6,4/6,5/6].map((x,i)=><div key={"v"+i} style={{position:"absolute",left:x*BW,top:0,width:1,height:"100%",background:x===0.5?"rgba(255,255,255,0.06)":"rgba(255,255,255,0.025)"}}/>)}
        {rows.map((rb,r)=>{const canDrop=sel!==null&&hand[sel]&&!hand[sel].type&&cFit(hand[sel],rb);const sweepOk=spM==="sweep"&&rb.length>0;const slideDest=spM==="slide"&&slideFrom&&r!==slideFrom.row;const rowActive=canDrop||sweepOk||slideDest;const ih=hov===r&&rowActive;return(<div key={"rz"+r} onPointerEnter={()=>sHov(r)} onPointerLeave={()=>sHov(null)} onClick={()=>{if(rowActive)onRowClick(r);}} style={{position:"absolute",top:r*RH,left:0,width:BW,height:RH,background:ih?"rgba(255,255,255,0.06)":rowActive?"rgba(255,255,255,0.02)":"transparent",cursor:rowActive?"pointer":"default",transition:"background 0.12s",zIndex:1}}/>);})}
        {rows.map((rb,r)=>rb.map((b,bi)=>{if(b.type)return null;const isR=rT&&rT.row===r&&rT.idx===bi;const isM=mA&&mA.row===r;const isSlideSrc=slideFrom&&slideFrom.row===r&&slideFrom.idx===bi;return(<div key={r+"-"+bi} onClick={()=>onBlkClick(r,bi)} style={{position:"absolute",top:r*RH+1.5,left:b.x*BW+1.5,transition:"top 0.15s cubic-bezier(0.34,1.56,0.64,1),left 0.3s ease-out",zIndex:isR||isSlideSrc?5:2,cursor:(spM||sel===null)?"pointer":"default",pointerEvents:spM==="sweep"?"none":undefined}}>
          <Blk f={b} w={fv(b)*BW} h={RH} clr={clrR.includes(r)} nw={nwB.some(nb=>nb.row===r&&nb.idx===bi)||isM} gl={!!spM||isR} hi={isSlideSrc}/>
          {spM&&!b.type&&<div style={{position:"absolute",inset:0,borderRadius:10,border:isSlideSrc?"2.5px solid #FFE66D":"2px solid rgba(56,189,248,0.5)",background:isSlideSrc?"rgba(255,230,109,0.12)":"rgba(56,189,248,0.08)",pointerEvents:"none"}}/>}
          {isR&&!spM&&(()=>{const opts=getRedOpts(b);return(<div className="fi" style={{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:4,background:"rgba(30,27,75,0.97)",borderRadius:10,padding:isTab?"10px 8px":"8px 6px",border:"1px solid rgba(255,255,255,0.12)",display:"flex",flexDirection:"column",gap:isTab?5:3,zIndex:20,minWidth:isTab?90:70,boxShadow:"0 8px 24px rgba(0,0,0,0.5)"}}>
            <div style={{fontSize:Math.round(9*fs),opacity:0.5,textAlign:"center"}}>ğŸ”„ é€šåˆ†ãƒ»ç´„åˆ†</div>
            {opts.length>0?opts.map((o,oi)=>{const oc=CC[o.d]||CC[2];return(<button key={oi} onClick={e=>{e.stopPropagation();appRed(r,bi,o);}} className="bs" style={{padding:isTab?"6px 10px":"4px 8px",borderRadius:6,fontSize:Math.round(13*fs),fontWeight:600,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",color:oc.lt,cursor:"pointer",fontFamily:"'Fredoka',sans-serif",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:4}}><span>{o.n}/{o.d}</span><span style={{fontSize:Math.round(8*fs),opacity:0.4}}>{o.label}</span></button>);}):<div style={{fontSize:Math.round(10*fs),opacity:0.5,padding:"2px 4px"}}>å¤‰æ›ãªã—</div>}
            <div style={{fontSize:Math.round(8*fs),opacity:0.35,textAlign:"center",marginTop:2}}>ğŸ’¡ åŒã˜åˆ†æ¯ã«ã™ã‚‹ã¨è‡ªå‹•åˆä½“ï¼</div>
          </div>);})()}
        </div>);}))}
        {mA&&<div className="mep" style={{position:"absolute",top:mA.row*RH+RH*0.2,left:"50%",zIndex:15,pointerEvents:"none"}}>{"ğŸ”— "+mA.eq}</div>}
        {sel!==null&&hand[sel]&&!hand[sel].type&&hov!==null&&cFit(hand[sel],rows[hov])&&(<div style={{position:"absolute",top:hov*RH+1.5,left:rSum(rows[hov])*BW+1.5,zIndex:3,pointerEvents:"none",opacity:0.4}}><Blk f={hand[sel]} w={fv(hand[sel])*BW} h={RH}/></div>)}
        {rows.map((rb,r)=>{if(!rb.length||clrR.includes(r))return null;const rem=rRem(rb);if(!rem||rem.n<=0)return null;return(<div key={"rm"+r} style={{position:"absolute",top:r*RH,right:isTab?-90:-72,height:RH,display:"flex",alignItems:"center",zIndex:4}}><div className="rt" style={{background:"rgba(255,255,255,0.06)",borderRadius:8,padding:isTab?"4px 10px":"3px 7px",fontSize:Math.round(11*fs),fontWeight:600,color:"#FFE66D",whiteSpace:"nowrap",border:"1px solid rgba(255,230,109,0.15)"}}>ã‚ã¨ <span style={{fontSize:Math.round(13*fs)}}>{rem.n}/{rem.d}</span></div></div>);})}
        {rows.map((rb,r)=>{if(!rb.length)return null;const s=rSum(rb);return(<div key={"fb"+r} style={{position:"absolute",top:(r+1)*RH-2.5,left:0,width:BW,height:2.5,background:"rgba(255,255,255,0.03)",zIndex:2,pointerEvents:"none"}}><div style={{width:Math.min(s,1)*100+"%",height:"100%",background:s>0.99?"#4ECDC4":"rgba(255,255,255,0.12)",borderRadius:2,transition:"width 0.2s"}}/></div>);})}
        {eq&&<div className="eqp" style={{position:"absolute",bottom:12,left:"50%",zIndex:10,pointerEvents:"none"}}>{eq}</div>}
        {msg&&<div className="mp" style={{position:"absolute",top:"35%",left:"50%",pointerEvents:"none",zIndex:10}}>{msg}</div>}

        {/* â”€â”€â”€ RETIRE CONFIRMATION â”€â”€â”€ */}
        {retCf&&gs==="playing"&&(<div className="fi" style={{position:"absolute",inset:0,background:"rgba(0,0,0,0.85)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backdropFilter:"blur(6px)",borderRadius:12,zIndex:25,padding:16}}>
          <div style={{fontSize:Math.round(18*fs),fontWeight:700,marginBottom:6}}>é€”ä¸­ã§çµ‚äº†ã™ã‚‹ï¼Ÿ</div>
          <div style={{fontSize:Math.round(11*fs),opacity:0.6,marginBottom:16,textAlign:"center",lineHeight:1.8}}>å®Œèµ°ãƒœãƒ¼ãƒŠã‚¹ï¼ˆ+300ç‚¹ï¼‰ãªã—<br/>ALTã‚‚å°‘ãªããªã‚Šã¾ã™</div>
          <div style={{display:"flex",gap:10}}>
            <button onClick={()=>setRetCf(false)} className="bs" style={{padding:isTab?"10px 24px":"8px 20px",fontSize:Math.round(13*fs),fontWeight:700,fontFamily:"'Fredoka',sans-serif",background:"linear-gradient(135deg,#4ECDC4,#2dbdb4)",color:"#fff",border:"none",borderRadius:12,cursor:"pointer",boxShadow:"0 4px 16px rgba(78,205,196,0.35)"}}>ç¶šã‘ã‚‹</button>
            <button onClick={doRetire} className="bs" style={{padding:isTab?"10px 24px":"8px 20px",fontSize:Math.round(13*fs),fontWeight:600,fontFamily:"'Fredoka',sans-serif",background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.7)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,cursor:"pointer"}}>ã‚„ã‚ã‚‹</button>
          </div>
        </div>)}
        {/* â”€â”€â”€ RESULT OVERLAY â”€â”€â”€ */}
        {(gs==="gameover"||gs==="perfect"||gs==="retire")&&(<div className="fi" style={{position:"absolute",inset:0,background:"rgba(0,0,0,0.88)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backdropFilter:"blur(6px)",borderRadius:12,zIndex:20,padding:isTab?16:8,overflow:"auto"}}>
          {isPf?(<><div style={{fontSize:isTab?44:36,marginBottom:4}}>ğŸ‰</div><div style={{fontSize:Math.round(22*fs),fontWeight:700,color:"#FFE66D",textShadow:"0 0 20px rgba(255,230,109,0.5)"}}>ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã‚¯ãƒªã‚¢ï¼</div></>):isRt?(<div style={{fontSize:Math.round(20*fs),fontWeight:700,marginBottom:2}}>é€”ä¸­çµ‚äº†</div>):(<div style={{fontSize:Math.round(20*fs),fontWeight:700,marginBottom:2}}>ãŠã¤ã‹ã‚Œã•ã¾ï¼</div>)}
          {df&&<div style={{fontSize:Math.round(10*fs),opacity:0.5,marginBottom:2}}>{DM[df].emoji+" "+DM[df].label}</div>}
          <div style={{fontSize:Math.round(20*fs),marginBottom:2,letterSpacing:4}}>{"â˜…".repeat(stars)+"â˜†".repeat(3-stars)}</div>
          <div style={{fontSize:isTab?50:42,fontWeight:700,color:ri.c,textShadow:"0 0 20px "+ri.c+"66",lineHeight:1}}>{ri.r}</div>
          <div style={{fontSize:Math.round(12*fs),color:ri.c,marginBottom:4,fontWeight:600}}>{ri.m}</div>
          <div style={{fontSize:Math.round(13*fs),opacity:0.8,marginBottom:1}}>ã‚¹ã‚³ã‚¢: <span style={{color:"#FFE66D",fontWeight:700,fontSize:Math.round(18*fs)}}>{sc.toLocaleString()}</span></div>
          <div style={{fontSize:Math.round(10*fs),opacity:0.5,marginBottom:4}}>{trn}ã‚¿ãƒ¼ãƒ³ / {tc}è¡Œã‚¯ãƒªã‚¢</div>
          {!isPf&&!isRt&&tc>=1&&(<div style={{fontSize:Math.round(11*fs),color:"#4ECDC4",fontWeight:600,marginBottom:2}}>ğŸ å®Œèµ°ãƒœãƒ¼ãƒŠã‚¹ +300</div>)}
          {isRt&&(<div style={{fontSize:Math.round(10*fs),opacity:0.5,marginBottom:2}}>ğŸ’¡ æœ€å¾Œã¾ã§éŠã¶ã¨å®Œèµ°ãƒœãƒ¼ãƒŠã‚¹+300ç‚¹</div>)}
          {/* ALT BIG DISPLAY */}
          {altSession>0&&(<div className="alt-result" style={{background:"rgba(78,205,196,0.12)",borderRadius:12,padding:isTab?"8px 24px":"6px 18px",border:"1.5px solid rgba(78,205,196,0.3)",marginBottom:6,textAlign:"center"}}>
            <div style={{fontSize:Math.round(28*fs),fontWeight:700,color:"#4ECDC4",lineHeight:1.2}}>+{altSession} ALT</div>
            <div style={{fontSize:Math.round(9*fs),opacity:0.5}}>åˆè¨ˆ: ğŸª™ {altTotal} ALT</div>
          </div>)}
          {TRAIL_PLAYER&&!isRt&&sc>0&&(<div style={{fontSize:Math.round(14*fs),fontWeight:700,color:"#06d6a0",marginBottom:6}}>{"ğŸª™ "+altSession+" ALT ã‚’ç²å¾—ï¼"}</div>)}
          {/* RANKING MINI */}
          {df&&rkWeek[df]&&rkWeek[df].length>0&&(<div style={{width:"100%",maxWidth:280,marginBottom:6}}>
            <div style={{fontSize:Math.round(10*fs),opacity:0.5,textAlign:"center",marginBottom:3}}>ğŸ“… é€±é–“ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆ{DM[df].label}ï¼‰</div>
            <RankMini entries={rkWeek[df]} myEntry={myRkEntry} myPos={myRkPos} fs={fs} isTab={isTab}/>
          </div>)}
          <div style={{display:"flex",gap:isTab?12:8,flexWrap:"wrap",justifyContent:"center"}}>
            <button onClick={()=>startG(df)} className="bs" style={{padding:isTab?"10px 26px":"8px 20px",fontSize:Math.round(14*fs),fontWeight:700,fontFamily:"'Fredoka',sans-serif",background:"linear-gradient(135deg,#A78BFA,#8b5cf6)",color:"#fff",border:"none",borderRadius:12,cursor:"pointer",boxShadow:"0 4px 16px rgba(139,92,246,0.35)"}}>ã‚‚ã†ä¸€å›ï¼</button>
            <button onClick={()=>{sGs("menu");sDf(null);}} className="bs" style={{padding:isTab?"10px 20px":"8px 16px",fontSize:Math.round(12*fs),fontWeight:600,fontFamily:"'Fredoka',sans-serif",background:"rgba(255,255,255,0.06)",color:"#fff",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,cursor:"pointer"}}>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸</button>
            <button onClick={goHome} className="bs" style={{padding:isTab?"10px 20px":"8px 16px",fontSize:Math.round(12*fs),fontWeight:600,fontFamily:"'Fredoka',sans-serif",background:"rgba(255,255,255,0.06)",color:"#fff",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,cursor:"pointer"}}>{"ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹"}</button>
          </div>
        </div>)}
      </div></div>

      {spM?null:sel!==null?(<div className="fi" style={{fontSize:Math.round(13*fs),opacity:0.7,color:"#FFE66D"}}>{hand[sel]?.type?"ğŸ‘† ä½¿ã„ãŸã„ãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚¿ãƒƒãƒ—ï¼":"ğŸ‘† ç½®ããŸã„è¡Œã‚’ã‚¿ãƒƒãƒ—ï¼"}</div>):gs==="playing"?(<div style={{fontSize:Math.round(11*fs),opacity:0.35,textAlign:"center",lineHeight:1.6}}>ğŸ‘‡ æ‰‹æœ­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’é¸ã¶ ï¼ ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ãƒƒãƒ—ã§é€šåˆ†</div>):null}

      {gs==="playing"&&(<div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:isTab?12:8}}>
        <div style={{display:"flex",gap:isTab?10:7,justifyContent:"center",alignItems:"flex-end",flexWrap:"wrap"}}>
          {hand.map((card,i)=>{const isSp=!!card.type,sp=SP_INFO[card.type],ok=isSp?rows.some(r=>r.length>0)||(card.type==="sweep"||card.type==="slide"):rows.some(r=>cFit(card,r)),co=isSp?CC.sp:(CC[card.d]||CC[2]),eo=isSp?[]:getEqOpts(card);return(<div key={i+"-"+card.n+"-"+card.d+"-"+(card.type||"")} style={{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",gap:4}}>
            <button onClick={()=>{sRT(null);sExI(null);if(sel===i){sSel(null);cancelSp();}else if(ok){sSel(i);if(isSp){sSpM(card.type);spR.current=i;}else{sSpM(null);setSlideFrom(null);}}}} className="cb" style={{width:cardW,padding:isTab?"10px 6px":"8px 4px",borderRadius:isTab?16:14,display:"flex",flexDirection:"column",alignItems:"center",gap:isTab?7:5,background:sel===i?"linear-gradient(145deg,"+co.lt+","+co.bg+")":"rgba(255,255,255,0.06)",border:sel===i?"2.5px solid "+co.lt:ok?"1.5px solid rgba(255,255,255,0.12)":"1.5px solid rgba(255,255,255,0.05)",color:sel===i?co.tx:"#fff",cursor:(ok||sel===i)?"pointer":"default",opacity:(ok||sel===i)?1:0.35,fontFamily:"'Fredoka',sans-serif",transform:sel===i?"translateY(-6px) scale(1.05)":"none",boxShadow:sel===i?"0 8px 24px "+co.gw+"44":"none",transition:"transform 0.15s,box-shadow 0.15s,opacity 0.15s",outline:"none"}}>
              {isSp?(<><span style={{fontSize:isTab?24:20}}>{sp.emoji}</span><div style={{fontSize:Math.round(11*fs),fontWeight:700}}>{sp.label}</div><div style={{fontSize:Math.round(8*fs),opacity:0.6,lineHeight:1.2}}>{sp.desc}</div></>):(<><Pie f={card} sz={isTab?(hSz>4?26:32):(hSz>4?22:28)}/><div style={{fontSize:Math.round((hSz>4?15:17)*fs),fontWeight:700}}>{card.n}<span style={{opacity:0.5,fontSize:Math.round((hSz>4?11:13)*fs)}}>/</span>{card.d}</div><div style={{width:isTab?(hSz>4?56:68):(hSz>4?46:56),height:isTab?7:5,borderRadius:3,background:"rgba(255,255,255,0.1)",overflow:"hidden"}}><div style={{width:fv(card)*100+"%",height:"100%",borderRadius:3,background:sel===i?co.lt:co.bg+"88",transition:"width 0.2s"}}/></div></>)}
            </button>
            {!isSp&&eo.length>0&&ok&&(<button onClick={e=>{e.stopPropagation();sExI(exI===i?null:i);}} className="bs" style={{fontSize:Math.round(9*fs),padding:isTab?"3px 8px":"2px 6px",borderRadius:6,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.5)",cursor:"pointer",fontFamily:"'Fredoka',sans-serif"}}>ğŸ”„å¤‰æ›</button>)}
            {exI===i&&!isSp&&(<div className="fi" style={{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:6,background:"rgba(30,27,75,0.95)",borderRadius:10,padding:isTab?"10px 8px":"8px 6px",border:"1px solid rgba(255,255,255,0.12)",display:"flex",flexDirection:"column",gap:isTab?5:4,zIndex:30,minWidth:isTab?90:70,boxShadow:"0 8px 24px rgba(0,0,0,0.4)"}}><div style={{fontSize:Math.round(9*fs),opacity:0.5,textAlign:"center"}}>ğŸ”„ å¤‰æ›å…ˆ</div>{eo.map((o,oi)=>(<button key={oi} onClick={e=>{e.stopPropagation();doEx(i,o);}} className="bs" style={{padding:isTab?"6px 10px":"5px 8px",borderRadius:7,fontSize:Math.round(14*fs),fontWeight:600,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",color:(CC[o.d]||CC[2]).lt,cursor:"pointer",fontFamily:"'Fredoka',sans-serif",textAlign:"center"}}>{o.n}/{o.d}</button>))}</div>)}
          </div>);})}
        </div>
        <div style={{display:"flex",gap:8,alignItems:"center"}}><button onClick={skip} disabled={skp<=0} className="bs" style={{padding:isTab?"8px 24px":"6px 18px",fontSize:Math.round(11*fs),fontWeight:600,fontFamily:"'Fredoka',sans-serif",background:skp>0?"rgba(255,255,255,0.06)":"rgba(255,255,255,0.02)",color:skp>0?"#fff":"rgba(255,255,255,0.3)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,cursor:skp>0?"pointer":"default"}}>{"ğŸ”„ æ‰‹æœ­ãƒã‚§ãƒ³ã‚¸ï¼ˆæ®‹ã‚Š"+skp+"å›ï¼‰"}</button><button onClick={()=>setRetCf(true)} className="bs" style={{padding:isTab?"8px 16px":"6px 12px",fontSize:Math.round(10*fs),fontWeight:600,fontFamily:"'Fredoka',sans-serif",background:"rgba(255,255,255,0.03)",color:"rgba(255,255,255,0.4)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:10,cursor:"pointer"}}>â¹ ã‚„ã‚ã‚‹</button></div>
      </div>)}
    </div>)}


    <style>{[
      "@keyframes fi{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fi{animation:fi .25s ease-out}",
      "@keyframes bc{0%{transform:scale(1);opacity:1}40%{transform:scaleX(1.15) scaleY(.85);opacity:.7}100%{transform:scaleY(0) scaleX(1.3);opacity:0}}.bc{animation:bc .3s cubic-bezier(.34,1.56,.64,1) forwards}",
      "@keyframes bn{0%{transform:scale(.8);opacity:0}60%{transform:scale(1.05);opacity:1}100%{transform:scale(1)}}.bn{animation:bn .2s ease-out}",
      "@keyframes bsh{0%,100%{transform:translateX(0)}25%{transform:translateX(-2px) translateY(1px)}50%{transform:translateX(2px)}75%{transform:translateX(-1px)}}.bsh{animation:bsh .18s ease-out}",
      "@keyframes sp{0%{transform:scale(1.3)}100%{transform:scale(1)}}.sp{animation:sp .15s cubic-bezier(.34,1.56,.64,1)}",
      "@keyframes mp{0%{transform:translate(-50%,-50%) scale(.5);opacity:0}20%{transform:translate(-50%,-50%) scale(1.1);opacity:1}100%{transform:translate(-50%,-70%) scale(1);opacity:0}}.mp{animation:mp 1.4s cubic-bezier(.34,1.56,.64,1) forwards;font-size:18px;font-weight:700;color:#FFE66D;text-shadow:0 0 12px rgba(255,230,109,.6);white-space:nowrap}",
      "@keyframes eqp{0%{transform:translateX(-50%) translateY(10px);opacity:0}15%{transform:translateX(-50%);opacity:1}80%{transform:translateX(-50%);opacity:1}100%{transform:translateX(-50%) translateY(-10px);opacity:0}}.eqp{animation:eqp 1.8s ease-out forwards;font-size:15px;font-weight:700;color:#4ECDC4;text-shadow:0 0 10px rgba(78,205,196,.5);white-space:nowrap;background:rgba(0,0,0,.6);padding:6px 14px;border-radius:10px}",
      "@keyframes mep{0%{transform:translate(-50%,0) scale(.6);opacity:0}15%{transform:translate(-50%,0) scale(1.1);opacity:1}70%{transform:translate(-50%,0);opacity:1}100%{transform:translate(-50%,-12px) scale(.95);opacity:0}}.mep{animation:mep 1.2s cubic-bezier(.34,1.56,.64,1) forwards;font-size:15px;font-weight:700;color:#4ECDC4;text-shadow:0 0 12px rgba(78,205,196,.5);white-space:nowrap;background:rgba(0,0,0,.7);padding:5px 14px;border-radius:10px;border:1px solid rgba(78,205,196,.3)}",
      "@keyframes rt{0%,100%{opacity:.7}50%{opacity:1}}.rt{animation:rt 2s ease-in-out infinite}",
      "@keyframes md{0%{transform:scale(1)}30%{transform:scale(1.05)}60%{background:rgba(78,205,196,.25)}100%{transform:scale(1)}}.md{animation:md 1.5s ease-out}",
      "@keyframes altUp{0%{transform:translate(-50%,0) scale(.7);opacity:0}15%{transform:translate(-50%,0) scale(1.2);opacity:1}70%{opacity:1}100%{transform:translate(-50%,-40px) scale(1);opacity:0}}.alt-float{animation:altUp 1.1s cubic-bezier(.34,1.56,.64,1) forwards;font-size:20px;font-weight:700;color:#06d6a0;text-shadow:0 0 10px rgba(6,214,160,.5);white-space:nowrap;transform:translateX(-50%)}",
      "@keyframes altR{0%{transform:scale(.5);opacity:0}30%{transform:scale(1.15);opacity:1}100%{transform:scale(1)}}.alt-result{animation:altR .5s cubic-bezier(.34,1.56,.64,1)}",
      ".bs{transition:transform .08s}.bs:active{transform:scale(.94)}",
      ".cb{outline:none}.cb:hover{filter:brightness(1.05)}",
      ".dc:hover{transform:translateY(-4px) scale(1.03)!important;border-color:rgba(255,255,255,.3)!important;background:rgba(255,255,255,.08)!important}"
    ].join("\n")}</style>
  </div>);
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
